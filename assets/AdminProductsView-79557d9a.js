import{j as V,l as n,f as b,a as $,_ as w,o as d,c as i,b as e,q as v,F as f,r as y,n as L,t as r,d as k,w as u,v as m,s as D,e as M,m as F,g as U,h as C}from"./index-f86386bb.js";import{g as I}from"./token-0bd692d3.js";const g=V("adminProductStore",{state:()=>({products:[],selectedProduct:{category:"",content:"",description:"",id:"",imageUrl:"",imagesUrl:[],is_enabled:0,origin_price:0,price:0,title:"",unit:"單位",num:0,rating:0},pagination:{total_pages:1,current_page:1},isNew:!0}),getters:{},actions:{async getProducts(t=1){n().setIsLoading(!0);try{const{data:s}=await b.get(`https://vue3-course-api.hexschool.io/v2/api/frank-hex-api/admin/products?page=${t}`,{headers:{Authorization:`${I()}`}});this.products=s.products,this.pagination=s.pagination}catch(s){alert(s.response.data.message)}finally{n().setIsLoading(!1)}},selectProduct(t){this.selectedProduct=t},clearProduct(){this.selectedProduct={category:"",content:"",description:"",id:"",imageUrl:"",imagesUrl:[],is_enabled:0,origin_price:0,price:0,title:"",unit:"單位",num:0,rating:0}},setIsNew(t){this.isNew=t}}}),A={name:"PaginationComponent",props:{},methods:{async pageChange(t){(t!==this.pagination.current_page||t>=0||t<=this.pagination.total_pages)&&await g().getProducts(t)}},computed:{...$(g,["pagination"])}},S={"aria-label":"Page navigation"},T={class:"pagination justify-content-center"},z={class:"page-item"},x=e("span",{"aria-hidden":"true"},"«",-1),B=[x],E=["onClick"],j={class:"page-item"},X=e("span",{"aria-hidden":"true"},"»",-1),q=[X];function G(t,s,h,p,_,a){return d(),i("nav",S,[e("ul",T,[e("li",z,[e("a",{class:"page-link",href:"#",onClick:s[0]||(s[0]=v(o=>a.pageChange(t.pagination.current_page-1),["prevent"]))},B)]),(d(!0),i(f,null,y(t.pagination.total_pages,o=>(d(),i("li",{class:L(["page-item",{active:t.pagination.current_page===o}]),key:o},[e("a",{class:"page-link",href:"#",onClick:v(l=>a.pageChange(o),["prevent"])},r(o),9,E)],2))),128)),e("li",j,[e("a",{class:"page-link",href:"#",onClick:s[1]||(s[1]=v(o=>a.pageChange(t.pagination.current_page+1),["prevent"]))},q)])])])}const H=w(A,[["render",G]]),J={name:"DeleteProductModal",methods:{async deleteProduct(t){console.log(t),n().setIsLoading(!0);try{const{data:s}=await b.delete(`https://vue3-course-api.hexschool.io/v2/api/frank-hex-api/admin/product/${t}`);s.success&&await g().getProducts()}catch(s){console.log(s)}finally{n().setIsLoading(!1)}}},computed:{...$(g,["selectedProduct"])}},K={class:"modal fade",id:"deleteProductModal",tabindex:"-1","aria-labelledby":"deleteProductModalLabel","aria-hidden":"true"},O={class:"modal-dialog"},Q={class:"modal-content"},R=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"deleteProductModalLabel"},"確定刪除？"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),W={class:"modal-body"},Y={class:"fw-bold fst-italic"},Z=e("br",null,null,-1),ee={class:"modal-footer"},te=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1);function se(t,s,h,p,_,a){return d(),i("div",K,[e("div",O,[e("div",Q,[R,e("div",W,[k(" 確定要刪除 "),e("span",Y,r(t.selectedProduct.title),1),k(" 嗎？ "),Z,k(" 刪除後將無法復原。 ")]),e("div",ee,[te,e("button",{type:"button",class:"btn btn-danger","data-bs-dismiss":"modal",onClick:s[0]||(s[0]=o=>a.deleteProduct(t.selectedProduct.id))}," 刪除 ")])])])])}const oe=w(J,[["render",se]]),ae={name:"UpdateProductModal",data(){return{modal:{}}},methods:{async updateProduct(t){if(n().setIsLoading(!0),this.selectedProduct.origin_price=Number(this.selectedProduct.origin_price),this.selectedProduct.price=Number(this.selectedProduct.price),t)try{const{data:s}=await b.post("https://vue3-course-api.hexschool.io/v2/api/frank-hex-api/admin/product",{data:this.selectedProduct},{headers:{Authorization:`${I()}`}});s.success&&await g().getProducts(),alert("產品新增成功")}catch{alert("產品新增失敗")}finally{n().setIsLoading(!1)}else try{const{data:s}=await b.put(`https://vue3-course-api.hexschool.io/v2/api/frank-hex-api/admin/product/${this.selectedProduct.id}`,{data:this.selectedProduct},{headers:{Authorization:`${I()}`}});s.success&&await g().getProducts(),alert("產品更新成功")}catch{alert("產品更新失敗")}finally{n().setIsLoading(!1)}},async uploadMainImage(t){if(t.target.files.length===0)return;n().setIsLoading(!0);const s=t.target.files[0],h=new FormData;h.append("file-to-upload",s);try{const{data:p}=await b.post("https://vue3-course-api.hexschool.io/v2/api/frank-hex-api/admin/upload",h,{headers:{"Content-Type":"multipart/form-data"}});this.selectedProduct.imageUrl=p.imageUrl,alert("圖片上傳成功")}catch{alert("圖片上傳失敗，請重新上傳")}finally{n().setIsLoading(!1)}},clearMainImageFile(){this.$refs["image-file"].value=""},addImage(){const t=this.selectedProduct.imagesUrl;t[t.length-1]!==""&&t.push("")},removeImagesUrl(t){this.selectedProduct.imagesUrl.splice(t,1)},async uploadImageFile(){const t=document.createElement("input");t.type="file",t.addEventListener("change",async s=>{n().setIsLoading(!0);const h=s.target.files[0],p=new FormData;p.append("file-to-upload",h);try{const{data:_}=await b.post("https://vue3-course-api.hexschool.io/v2/api/frank-hex-api/admin/upload",p,{headers:{"Content-Type":"multipart/form-data"}}),a=this.selectedProduct.imagesUrl;a[a.length-1]===""?a[a.length-1]=_.imageUrl:a.push(_.imageUrl),alert("圖片上傳成功")}catch{alert("圖片上傳失敗，請重新上傳")}finally{n().setIsLoading(!1)}}),t.click()}},computed:{...$(g,["selectedProduct","isNew"])}},le={class:"modal fade",id:"updateProductModal",tabindex:"-1","aria-labelledby":"updateProductModalLabel","aria-hidden":"true"},de={class:"modal-dialog modal-xl"},ie={class:"modal-content"},ne={class:"modal-header"},re={class:"modal-title fs-5",id:"updateProductModalLabel"},ce=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),ue={class:"modal-body"},pe={class:"row"},me={class:"col"},ge={class:"mb-3"},he=e("label",{for:"title",class:"form-label"},"標題",-1),_e={class:"mb-3"},be=e("label",{for:"title",class:"form-label"},"描述",-1),fe={class:"mb-3"},Pe=e("label",{for:"title",class:"form-label"},"說明",-1),ve={class:"row mb-3"},ye={class:"col"},$e=e("label",{for:"category",class:"form-label"},"分類",-1),we={class:"col"},ke=e("label",{for:"unit",class:"form-label"},"單位",-1),Ue={class:"row mb-3"},Ce={class:"col"},Ie=e("label",{for:"origin-price",class:"form-label"},"原價",-1),Me={class:"col"},Le=e("label",{for:"price",class:"form-label"},"售價",-1),Ne={class:"row mb-3"},Ve={class:"col"},De=e("label",{class:"form-label"},"商品評價",-1),Fe=["onClick"],Ae={class:"material-symbols-outlined"},Se={class:"col"},Te={class:"form-check form-switch"},ze=e("label",{class:"form-check-label",for:"is-enabled"},"是否啟用",-1),xe={class:"row mb-3"},Be=e("label",{for:"image-url",class:"form-label"},"產品主圖",-1),Ee={class:"col"},je={class:"col input-group"},Xe={class:"text-center"},qe=["src"],Ge={class:"col"},He={class:"text-end mb-3"},Je=e("hr",null,null,-1),Ke={class:"row mb-3"},Oe=["for"],Qe={class:"input-group"},Re=["id","placeholder","onUpdate:modelValue"],We=["onClick"],Ye={class:"text-start"},Ze=["src","alt"],et={class:"modal-footer"},tt=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1);function st(t,s,h,p,_,a){return d(),i("div",le,[e("div",de,[e("div",ie,[e("div",ne,[e("h1",re,r(`${t.isNew?"新增":"更新"}`)+"產品 ",1),ce]),e("div",ue,[e("div",pe,[e("div",me,[e("form",null,[e("div",ge,[he,u(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":s[0]||(s[0]=o=>t.selectedProduct.title=o)},null,512),[[m,t.selectedProduct.title]])]),e("div",_e,[be,u(e("textarea",{type:"text",class:"form-control",id:"content","onUpdate:modelValue":s[1]||(s[1]=o=>t.selectedProduct.content=o)},null,512),[[m,t.selectedProduct.content]])]),e("div",fe,[Pe,u(e("textarea",{type:"text",class:"form-control",id:"description","onUpdate:modelValue":s[2]||(s[2]=o=>t.selectedProduct.description=o)},null,512),[[m,t.selectedProduct.description]])]),e("div",ve,[e("div",ye,[$e,u(e("input",{type:"text",class:"form-control",id:"category","onUpdate:modelValue":s[3]||(s[3]=o=>t.selectedProduct.category=o)},null,512),[[m,t.selectedProduct.category]])]),e("div",we,[ke,u(e("input",{type:"text",class:"form-control",id:"unit","onUpdate:modelValue":s[4]||(s[4]=o=>t.selectedProduct.unit=o)},null,512),[[m,t.selectedProduct.unit]])])]),e("div",Ue,[e("div",Ce,[Ie,u(e("input",{type:"number",class:"form-control",id:"origin-price","onUpdate:modelValue":s[5]||(s[5]=o=>t.selectedProduct.origin_price=o)},null,512),[[m,t.selectedProduct.origin_price,void 0,{number:!0}]])]),e("div",Me,[Le,u(e("input",{type:"number",class:"form-control",id:"price","onUpdate:modelValue":s[6]||(s[6]=o=>t.selectedProduct.price=o)},null,512),[[m,t.selectedProduct.price,void 0,{number:!0}]])])]),e("div",Ne,[e("div",Ve,[De,e("div",null,[(d(),i(f,null,y(5,o=>e("a",{href:"#",class:"text-decoration-none text-warning",onClick:v(l=>t.selectedProduct.rating=o,["prevent"]),key:o},[e("span",Ae,r(o<=t.selectedProduct.rating?"stars":"star"),1)],8,Fe)),64))])]),e("div",Se,[e("div",Te,[ze,u(e("input",{class:"form-check-input",type:"checkbox",id:"is-enabled",role:"switch","true-value":1,"false-value":0,"onUpdate:modelValue":s[7]||(s[7]=o=>t.selectedProduct.is_enabled=o)},null,512),[[D,t.selectedProduct.is_enabled]])])])]),e("div",xe,[Be,e("div",Ee,[u(e("input",{type:"text",class:"form-control",id:"image-url",placeholder:"請輸入主圖網址","onUpdate:modelValue":s[8]||(s[8]=o=>t.selectedProduct.imageUrl=o)},null,512),[[m,t.selectedProduct.imageUrl]])]),e("div",je,[e("input",{type:"file",class:"form-control",onChange:s[9]||(s[9]=(...o)=>a.uploadMainImage&&a.uploadMainImage(...o)),ref:"image-file"},null,544),e("button",{type:"button",class:"btn btn-outline-danger",onClick:s[10]||(s[10]=(...o)=>a.clearMainImageFile&&a.clearMainImageFile(...o))}," X ")]),e("div",Xe,[t.selectedProduct.imageUrl.length>0?(d(),i("img",{key:0,class:"img-fluid w-50 mt-3",src:t.selectedProduct.imageUrl,alt:"產品主圖"},null,8,qe)):M("",!0)])])])]),e("div",Ge,[e("div",He,[e("button",{type:"button",class:"btn btn-outline-primary me-3",onClick:s[11]||(s[11]=(...o)=>a.addImage&&a.addImage(...o))}," 新增圖片 "),e("button",{type:"button",class:"btn btn-outline-success",onClick:s[12]||(s[12]=(...o)=>a.uploadImageFile&&a.uploadImageFile(...o))}," 上傳圖片 ")]),Je,e("form",null,[e("div",Ke,[(d(!0),i(f,null,y(t.selectedProduct.imagesUrl,(o,l)=>(d(),i("div",{class:"col-6",key:o.id},[e("label",{for:`image-url-${l+1}`,class:"form-label"},"圖片網址 "+r(l+1),9,Oe),e("div",Qe,[u(e("input",{type:"text",class:"form-control",id:`image-url-${l+1}`,placeholder:`請輸入圖片網址 ${l+1}`,"onUpdate:modelValue":P=>t.selectedProduct.imagesUrl[l]=P},null,8,Re),[[m,t.selectedProduct.imagesUrl[l]]]),e("button",{type:"button",class:"btn btn-outline-danger",onClick:P=>a.removeImagesUrl(l)}," X ",8,We)]),e("div",Ye,[t.selectedProduct.imagesUrl[l].length?(d(),i("img",{key:0,class:"img-fluid w-100 mt-3",src:t.selectedProduct.imagesUrl[l],alt:`產品圖片 ${l}`},null,8,Ze)):M("",!0)])]))),128))])])])])]),e("div",et,[tt,e("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal",onClick:s[13]||(s[13]=o=>a.updateProduct(t.isNew))},r(t.isNew?"新增":"更新"),1)])])])])}const ot=w(ae,[["render",st]]),at={name:"AdminProductsView",components:{Pagination:H,DeleteProductModal:oe,UpdateProductModal:ot},data(){return{}},methods:{...F(g,["clearProduct","getProducts","selectProduct","setIsNew"]),showUpdateProductModal(t){this.selectProduct({...t}),this.setIsNew(!1)},showDeleteProductModal(t){this.selectProduct(t)}},computed:{...$(g,["products","pagination","selectedProduct","isNew"])},async mounted(){await this.getProducts()}},lt={class:"container mt-3"},dt={class:"text-end"},it={class:"table"},nt=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"分類"),e("th",{scope:"col"},"產品名稱"),e("th",{scope:"col"},"原價"),e("th",{scope:"col"},"售價"),e("th",{scope:"col"},"是否啟用"),e("th",{scope:"col"},"編輯")])],-1),rt=["onClick"],ct=["onClick"];function ut(t,s,h,p,_,a){const o=U("pagination"),l=U("update-product-modal"),P=U("delete-product-modal");return d(),i(f,null,[e("div",lt,[e("div",dt,[e("button",{class:"btn btn-primary","data-bs-toggle":"modal","data-bs-target":"#updateProductModal",onClick:s[0]||(s[0]=c=>{t.setIsNew(!0),t.clearProduct()})}," 建立新產品 ")]),e("table",it,[nt,e("tbody",null,[(d(!0),i(f,null,y(t.products,c=>(d(),i("tr",{key:c.id},[e("th",null,r(c.category),1),e("td",null,r(c.title),1),e("td",null,r(c.origin_price),1),e("td",null,r(c.price),1),e("td",{class:L(c.is_enabled?"text-success":"")},r(c.is_enabled?"已啟用":"未啟用"),3),e("td",null,[e("button",{class:"btn btn-sm btn-outline-primary me-3","data-bs-toggle":"modal","data-bs-target":"#updateProductModal",onClick:N=>a.showUpdateProductModal(c)}," 編輯 ",8,rt),e("button",{class:"btn btn-sm btn-outline-danger","data-bs-toggle":"modal","data-bs-target":"#deleteProductModal",onClick:N=>a.showDeleteProductModal(c)}," 刪除 ",8,ct)])]))),128))])]),C(o)]),C(l,{ref:"update-product-modal"},null,512),C(P,{ref:"delete-product-modal"},null,512)],64)}const gt=w(at,[["render",ut]]);export{gt as default};
